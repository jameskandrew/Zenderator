<?php
namespace {{ app_namespace }}\SDK\{{ app_name }}\Models\Base;

use Gone\SDK\Common\Abstracts\AbstractModel;
use Gone\SDK\Common\Traits\PresentableTrait;
use {{ app_namespace }}\SDK\{{ app_name }}\AccessLayer\{{ pack_name }}AccessLayer;
use {{ app_namespace }}\SDK\{{ app_name }}\Models\{{ pack_name }}Model;

abstract class Base{{ pack_name }}Model extends AbstractModel
{
    use PresentableTrait;

{% for propertyName, data in propertyData %}
    const FIELD_{{ propertyName|upper }} = '{{ propertyName|transform_studly_to_camel }}';
{% endfor %}

    //Property DB Types
{% for propertyName, data in propertyData %}
    const DBTYPE_{{ propertyName|upper }} = '{{ data.type }}';
{% endfor %}

    // Constant arrays defined by ENUMs
{% for propertyName, property in propertiesOptions %}
    const OPTIONS_{{ propertyName|upper }} = ["{{ property | join('", "') | raw }}"];
{% endfor %}
{% for propertyName, data in propertyData %}
    {% if data.options is not empty %}
    const OPTIONS2_{{ propertyName|upper }} = ["{{ data.options | join('", "') | raw }}"];
    {% endif %}
{% endfor %}

{% for propertyName, property in propertiesOptions %}
{% for permittedValue in property %}
    const {{ propertyName|upper }}_{{ permittedValue|upper|replace({'-':'_'}) }} = '{{ permittedValue }}';
{% endfor %}
{% endfor %}

    // Properties
{% for propertyName, data in propertyData %}
    /** @var {{ data.phpType }} ${{ propertyName }} */
    protected ${{ propertyName }};
{% endfor %}

    public function __toArray() : array
    {
        return [
{% for property in properties %}
            "{{ property }}" => $this->get{{ property }}(),
{% endfor %}
        ];
    }

    protected function getAccessLayer() : {{ pack_name }}AccessLayer
    {
        return new {{ pack_name }}AccessLayer($this->sdkClient);
    }

    /**
     * Convenience function to create/update the current model.
     */
    public function save() : {{ pack_name }}Model
    {
        return $this->getAccessLayer()->createFromObject($this);
    }

    // Getters and Setters
{% for propertyName, data in propertyData %}
    public function get{{ propertyName }}() : {{ data.phpType }}
    {
        return $this->{{ propertyName }};
    }

    public function set{{ propertyName }}(${{ propertyName }}) : {{ pack_name }}Model
    {
        if($this->{{ propertyName }} != ${{ propertyName }}){
            $this->addDirtyKey('{{ propertyName }}');
            $this->{{ propertyName }} = ${{ propertyName }};
        }
        return $this;
    }

{% endfor %}
}
