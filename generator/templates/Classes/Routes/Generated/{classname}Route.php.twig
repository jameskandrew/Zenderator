<?php

use {{ class.namespace }}\Controllers\{{ class.name }}Controller;
use {{ class.namespace }}\Models\{{ class.name }}Model;
use Gone\AppCore\Router\Route;
use Gone\AppCore\Router\Router;

// Router proper begins
$router = Router::Instance()
    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Get All')
            ->setCallback({{ class.name }}Controller::class . ':getAllRequest')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'getAll')
            ->setRouterPattern('/v1/{{ class.plural|lower }}')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}')
            ->setHttpMethod('GET')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )
    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Create')
            ->setCallback({{ class.name }}Controller::class . ':createRequest')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'create')
            ->setRouterPattern('/v1/{{ class.plural|lower }}')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}')
            ->setHttpMethod('PUT')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )
{#    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Create Bulk')
            ->setCallback({{ class.name }}Controller::class . ':createBulkRequest')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'createBulk')
            ->setRouterPattern('/v1/{{ class.plural|lower }}/bulk')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}/bulk')
            ->setHttpMethod('PUT')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )#}
    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Update')
            ->setCallback({{ class.name }}Controller::class . ':updateRequest')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'update')
            ->setRouterPattern('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ '{' }}{{ key }}{{ ':[0-9]+}' }}{{ loop.last ? '' : '/' }}{% endfor %}')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ key }}{{ loop.last ? '' : '/' }}{% endfor %}')
            ->setHttpMethod('PATCH')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )
    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Get')
            ->setCallback({{ class.name }}Controller::class . ':getRequest')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'get')
            ->setRouterPattern('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ '{' }}{{ key }}{{ ':[0-9]+}' }}{{ loop.last ? '' : '/' }}{% endfor %}')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ key }}{{ loop.last ? '' : '/' }}{% endfor %}')
            ->setHttpMethod('GET')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )
{% if "Validators" in config.templates %}
    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Validate')
            ->setCallback({{ class.name }}Controller::class . ':validateRequest')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'validate')
            ->setRouterPattern('/v1/{{ class.plural|lower }}/validate')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}/validate')
            ->setHttpMethod('POST')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )
{% endif %}
{% for related in class.relatedData %}
{% if loop.first %}
    //Related Data
{% endif %}
{% for field in related.fields %}
    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Get {{ field.related.variableUC }} Model')
            ->setCallback({{ class.name }}Controller::class . ':{{ field.related.variable }}Request')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'get{{ field.related.variableUC }}')
            ->setRouterPattern('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ '{' }}{{ key }}{{ ':[0-9]+}' }}{{ loop.last ? '' : '/' }}{% endfor %}/{{ field.related.variable }}')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ key }}{{ loop.last ? '' : '/' }}{% endfor %}/{{ field.related.variable }}')
            ->setHttpMethod('GET')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )
{% endfor %}
{% endfor %}
{% for remote in class.remoteData %}
{% if loop.first %}
    //Remote Data
{% endif %}
{% set remoteClass = classes[remote.class.name].class %}
{% for field in remote.fields %}
    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Get {{ field.remote.variableUC }} Model')
            ->setCallback({{ class.name }}Controller::class . ':{{ field.remote.variablePlural }}Request')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'get{{ field.remote.variablePluralUC }}')
            ->setRouterPattern('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ '{' }}{{ key }}{{ ':[0-9]+}' }}{{ loop.last ? '' : '/' }}{% endfor %}/{{ field.remote.variablePlural }}')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ key }}{{ loop.last ? '' : '/' }}{% endfor %}/{{ field.remote.variablePlural }}')
            ->setHttpMethod('GET')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )
    ->addRoute(
        Route::Factory()
            ->setName('{{ class.name }} Get {{ field.remote.variableUC }} Model')
            ->setCallback({{ class.name }}Controller::class . ':{{ field.remote.variablePlural }}Request')
            ->setSdkRef({{ class.name }}Model::NAME_SINGULAR,'get{{ field.remote.variablePluralUC }}')
            ->setRouterPattern('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ '{' }}{{ key }}{{ ':[0-9]+}' }}{{ loop.last ? '' : '/' }}{% endfor %}/{{ field.remote.variablePlural }}/{% for key in remoteClass.routePKs %}{{ '{' }}{{ remote.class.name }}_{{ key }}{{ ':[0-9]+}' }}{{ loop.last ? '' : '/' }}{% endfor %}')
            ->setHttpEndpoint('/v1/{{ class.plural|lower }}/{% for key in class.routePKs %}{{ key }}{{ loop.last ? '' : '/' }}{% endfor %}/{{ field.remote.variablePlural }}/{% for key in remoteClass.routePKs %}{{ remote.class.name }}_{{ key }}{{ loop.last ? '' : '/' }}{% endfor %}')
            ->setHttpMethod('GET')
            ->setAccess(DEFAULT_ROUTE_ACCESS_MODE)
    )
{% endfor %}
{% endfor %}
;


